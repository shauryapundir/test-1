<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Shop – Minikids</title>

<!-- Bootstrap & icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Global styles -->
<link rel="stylesheet" href="style.css">

<style>
/* ---------- page-specific tweaks ---------- */
.card-product{transition:.25s;box-shadow:0 2px 8px rgba(0,0,0,.07)}
.card-product:hover{transform:translateY(-4px);box-shadow:0 6px 18px rgba(0,0,0,.15)}
.card-product img{height:230px;object-fit:contain}
.price-mrp{text-decoration:line-through;color:#777;font-size:.95rem}
.filter-select{font-size:.9rem}
</style>
</head>

<body>
<!-- ---------- sticky header ---------- -->
<div class="sticky-header-wrapper bg-white shadow-sm">
  <header class="site-header py-2">
    <div class="container-fluid d-flex align-items-center justify-content-between">
      <a href="index.html"><img src="img/logo.jpg" class="site-logo" style="height:40px"></a>
      <button class="btn d-lg-none" data-bs-toggle="collapse" data-bs-target="#mobileMenu"><i class="fas fa-bars fs-4"></i></button>

      <!-- desktop search -->
      <form class="search-wrapper flex-grow-1 mx-4 position-relative">
        <input id="searchBox" class="form-control search-input" placeholder="Search">
        <div id="searchSuggestions" class="list-group position-absolute w-100 z-3" style="display:none"></div>
      </form>

      <!-- desktop icons -->
      <nav class="icon-bar d-none d-lg-flex gap-4">
        <a href="index.html"  class="icon-link"><span class="material-icons">home</span></a>
        <a href="shop.html"   class="icon-link"><span class="material-icons">store</span></a>
        <a href="account.html" class="icon-link"><span class="material-icons">person</span></a>
        <a href="wishlist.html" class="icon-link position-relative">
          <span class="material-icons">favorite</span>
          <span id="wishlist-count" class="badge rounded-pill bg-danger position-absolute top-0 start-100 translate-middle">0</span>
        </a>
        <a href="cart.html" class="icon-link position-relative">
          <span class="material-icons">shopping_bag</span>
          <span id="cart-count" class="badge rounded-pill bg-danger position-absolute top-0 start-100 translate-middle">0</span>
        </a>
      </nav>
    </div>

    <!-- mobile menu -->
    <div id="mobileMenu" class="collapse d-lg-none bg-light p-3">
      <a href="index.html"   class="d-block mb-2"><span class="material-icons">home</span> Home</a>
      <a href="shop.html"    class="d-block mb-2"><span class="material-icons">store</span> Shop</a>
      <a href="account.html" class="d-block mb-2"><span class="material-icons">person</span> Account</a>
      <a href="wishlist.html" class="d-block mb-2"><span class="material-icons">favorite</span> Wishlist</a>
      <a href="cart.html"    class="d-block"><span class="material-icons">shopping_bag</span> Cart</a>
    </div>
  </header>
</div>

<!-- ---------- filters & products ---------- -->
<section class="container my-5">
  <div class="row">
    <!-- sidebar -->
    <aside class="col-lg-3 mb-4">
      <div class="bg-light p-3 rounded">
        <h5 class="mb-3">Product Type</h5>
        <div id="typeBox"></div>
        <a id="typeToggle" href="#" class="d-block mb-3 fw-semibold text-decoration-none" style="color:#cbb26a">+ more</a>

        <h5 class="mb-2 mt-4">Price</h5>
        <input type="range" id="priceRange" class="form-range">
        <div id="priceLabel" class="small text-center mb-2"></div>

        <label class="form-label mt-3">Category</label>
        <select id="fCategory" class="form-select filter-select mb-2">
          <option value="">All</option><option value="newborn">Newborn</option>
          <option value="baby">Baby</option><option value="kids">Kids</option>
        </select>

        <label class="form-label">Gender</label>
        <select id="fGender" class="form-select filter-select mb-2">
          <option value="">All</option><option value="boys">Boys</option>
          <option value="girls">Girls</option><option value="unisex">Unisex</option>
        </select>

        <label class="form-label">Discount</label>
        <select id="fDiscount" class="form-select filter-select">
          <option value="">All</option><option value="10">10%+</option>
          <option value="20">20%+</option><option value="30">30%+</option>
        </select>
      </div>
    </aside>

    <!-- main column -->
    <div class="col-lg-9">
      <!-- sort -->
      <div class="d-flex justify-content-end mb-3">
        <select id="sortSelect" class="form-select w-auto">
          <option value="">Sort by</option>
          <option value="priceAsc">Price – Low to High</option>
          <option value="priceDesc">Price – High to Low</option>
          <option value="nameAsc">Name A-Z</option>
          <option value="nameDesc">Name Z-A</option>
        </select>
      </div>
      <!-- grid -->
      <div id="productList" class="row g-4"></div>
    </div>
  </div>
</section>

<!-- ---------- footer (unchanged) ---------- -->
<footer class="py-5 bg-light">
  <div class="container">
    <div class="row gy-3">
      <div class="col-lg-6"><img src="img/logo.jpg" style="height:50px"><br>High-quality baby products designed with care.</div>
      <div class="col-6 col-lg-2"><h6>Account</h6><a href="#">Orders</a><br><a href="#">Help</a></div>
      <div class="col-6 col-lg-2"><h6>Info</h6><a href="#">About</a><br><a href="#">Returns</a></div>
      <div class="col-lg-2"><h6>Newsletter</h6><input class="form-control form-control-sm mb-2" placeholder="Email"><button class="btn btn-dark btn-sm w-100">Subscribe</button></div>
    </div>
  </div>
</footer>

<!-- ---------- JS bundles ---------- -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
<script src="products.js"></script>   <!-- provides window.allProducts -->
<script src="cart.js"></script>       <!-- cart badge helpers etc. -->

<script>
/* ---------- helpers ---------- */
const $ = id => document.getElementById(id);
const formatPrice = n => `₹${n.toLocaleString()}`;

/* ---------- dynamic sidebar (types & price) ---------- */
function buildTypeList(){
  const counts = {};
  window.allProducts.forEach(p => counts[p.type] = (counts[p.type] || 0) + 1);

  $("typeBox").innerHTML = Object.entries(counts)
    .sort((a, b) => a[0].localeCompare(b[0]))
    .map(([t, c], i) => `
      <label class="d-flex justify-content-between align-items-center mb-1${i >= 5 ? ' d-none extra-type' : ''}">
        <input type="checkbox" value="${t}" class="form-check-input me-2 chk-type">
        <span>${t[0].toUpperCase() + t.slice(1)}</span>
        <span class="text-muted">${c}</span>
      </label>`).join("");

  $("typeToggle").onclick = e => {
    e.preventDefault();
    document.querySelectorAll(".extra-type").forEach(el => el.classList.toggle("d-none"));
    e.target.textContent = e.target.textContent.startsWith("+") ? "– less" : "+ more";
  };
  document.querySelectorAll(".chk-type").forEach(cb => cb.addEventListener("change", applyFilters));
}

function buildPriceSlider(){
  const prices = window.allProducts.map(p => p.price);
  const min = Math.min(...prices), max = Math.max(...prices);
  const rng = $("priceRange"), lbl = $("priceLabel");
  rng.min = min; rng.max = max; rng.value = max;
  lbl.textContent = `${formatPrice(min)} – ${formatPrice(max)}`;
  rng.oninput = () => { lbl.textContent = `${formatPrice(min)} – ${formatPrice(rng.value)}`; applyFilters(); };
  window._priceRange = { maxCtrl: rng };
}

/* ---------- sorting helper ---------- */
function sortList(arr, rule){
  switch (rule){
    case "priceAsc":  return [...arr].sort((a, b) => a.price - b.price);
    case "priceDesc": return [...arr].sort((a, b) => b.price - a.price);
    case "nameAsc":   return [...arr].sort((a, b) => a.name.localeCompare(b.name));
    case "nameDesc":  return [...arr].sort((a, b) => b.name.localeCompare(a.name));
    default:          return arr;
  }
}
let currentSort = "";

/* ---------- render cards ---------- */
function render(list){
  const grid = $("productList");
  if (!list.length){
    grid.innerHTML = `<div class="col-12 text-center text-muted">No products found</div>`;
    return;
  }
  grid.innerHTML = list.map(p => {
    const off = p.mrp && p.mrp > p.price ? Math.round((p.mrp - p.price) / p.mrp * 100) : 0;
    return `<div class="col-md-4 mb-4">
      <div class="card card-product h-100 p-3 text-center shadow-sm">
        <img src="${p.images[0]}" class="img-fluid rounded" alt="${p.name}">
        <div class="mt-3">
          <h6 class="text-muted small">${Array.isArray(p.category) ? p.category.join(", ") : p.category}</h6>
          <h5 class="fw-bold">${p.name}</h5>
          ${p.mrp && p.mrp > p.price
              ? `<div><span class="price-mrp me-1">${formatPrice(p.mrp)}</span><span class="text-danger fw-semibold">${formatPrice(p.price)}</span></div>`
              : `<div class="text-danger fw-semibold">${formatPrice(p.price)}</div>`}
          ${off ? `<span class="badge bg-success mt-2">${off}% off</span>` : ""}
          <a href="product.html?id=${p.id}" class="btn btn-info text-white w-100 mt-3">Buy Now</a>
        </div>
      </div>
    </div>`;
  }).join("");
}

/* ---------- master filter ---------- */
function applyFilters(){
  const cat   = $("fCategory").value;
  const gen   = $("fGender").value;
  const disc  = $("fDiscount").value;
  const types = [...document.querySelectorAll(".chk-type:checked")].map(x => x.value);
  const maxP  = parseFloat(_priceRange.maxCtrl.value);

  let out = window.allProducts.filter(p => {
    if (cat   && !(Array.isArray(p.category) ? p.category.includes(cat) : p.category === cat)) return false;
    if (gen   && p.gender !== gen)          return false;
    if (types.length && !types.includes(p.type)) return false;
    if (p.price > maxP)                     return false;
    if (disc){
      const d = p.mrp && p.mrp > p.price ? (p.mrp - p.price) / p.mrp * 100 : 0;
      if (d < +disc) return false;
    }
    return true;
  });

  out = sortList(out, currentSort);
  render(out);
}

/* ---------- search suggestions ---------- */
function wireSearch(){
  const box = $("searchBox"), sug = $("searchSuggestions");
  if (!box || !sug) return;

  box.addEventListener("input", () => {
    const q = box.value.trim().toLowerCase();
    if (!q){ sug.style.display = "none"; return; }
    const hit = window.allProducts.filter(p => p.name.toLowerCase().includes(q)).slice(0, 6);
    sug.innerHTML = hit.length
      ? hit.map(p => `
          <a href="product.html?id=${p.id}" class="list-group-item list-group-item-action d-flex align-items-center">
            <img src="${p.images[0]}" style="width:40px;height:40px;object-fit:cover" class="me-2">${p.name}
          </a>`).join("")
      : `<div class="list-group-item text-muted">No results</div>`;
    sug.style.display = "block";
  });

  document.addEventListener("click", e => {
    if (!sug.contains(e.target) && e.target !== box) sug.style.display = "none";
  });
}

/* ---------- boot ---------- */
document.addEventListener("DOMContentLoaded", () => {
  buildTypeList();
  buildPriceSlider();
  render(window.allProducts);

  ["fCategory", "fGender", "fDiscount"].forEach(id => $(id).addEventListener("change", applyFilters));
  $("sortSelect").addEventListener("change", e => { currentSort = e.target.value; applyFilters(); });
  wireSearch();
  updateCartCount && updateCartCount();
});
</script>

</body>
</html>
